"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[989],{3989:function(e,r,t){t.d(r,{Ge:function(){return F}});var n,s,a,o,i=t(6560),c=t(1048),u=t(9287),l=t(2036),f=t(8542);function d(e,r,t,n){return new(t||(t=Promise))((function(s,a){function o(e){try{c(n.next(e))}catch(r){a(r)}}function i(e){try{c(n.throw(e))}catch(r){a(r)}}function c(e){var r;e.done?s(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(o,i)}c((n=n.apply(e,r||[])).next())}))}function T(e,r){var t,n,s,a,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(a){return function(i){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,n&&(s=2&a[0]?n.return:a[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,a[1])).done)return s;switch(n=0,s&&(a=[2&a[0],s.value]),a[0]){case 0:case 1:s=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!s||a[1]>s[0]&&a[1]<s[3])){o.label=a[1];break}if(6===a[0]&&o.label<s[1]){o.label=s[1],s=a;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(a);break}s[2]&&o.ops.pop(),o.trys.pop();continue}a=r.call(e,o)}catch(i){a=[6,i],n=0}finally{t=s=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,i])}}}!function(e){e[e.cTFETC1=0]="cTFETC1",e[e.cTFETC2=1]="cTFETC2",e[e.cTFBC1=2]="cTFBC1",e[e.cTFBC3=3]="cTFBC3",e[e.cTFBC4=4]="cTFBC4",e[e.cTFBC5=5]="cTFBC5",e[e.cTFBC7=6]="cTFBC7",e[e.cTFPVRTC1_4_RGB=8]="cTFPVRTC1_4_RGB",e[e.cTFPVRTC1_4_RGBA=9]="cTFPVRTC1_4_RGBA",e[e.cTFASTC_4x4=10]="cTFASTC_4x4",e[e.cTFATC_RGB=11]="cTFATC_RGB",e[e.cTFATC_RGBA_INTERPOLATED_ALPHA=12]="cTFATC_RGBA_INTERPOLATED_ALPHA",e[e.cTFRGBA32=13]="cTFRGBA32",e[e.cTFRGB565=14]="cTFRGB565",e[e.cTFBGR565=15]="cTFBGR565",e[e.cTFRGBA4444=16]="cTFRGBA4444"}(o||(o={}));var _=((n={})[o.cTFETC1]=u.si.COMPRESSED_RGB_ETC1_WEBGL,n[o.cTFBC1]=u.si.COMPRESSED_RGB_S3TC_DXT1_EXT,n[o.cTFBC3]=u.si.COMPRESSED_RGBA_S3TC_DXT5_EXT,n[o.cTFPVRTC1_4_RGB]=u.si.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,n[o.cTFPVRTC1_4_RGBA]=u.si.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,n[o.cTFATC_RGB]=u.si.COMPRESSED_RGB_ATC_WEBGL,n[o.cTFASTC_4x4]=u.si.COMPRESSED_RGBA_ASTC_4x4_KHR,n),m=((s={})[o.cTFRGBA32]=c.vK.UNSIGNED_BYTE,s[o.cTFRGB565]=c.vK.UNSIGNED_SHORT_5_6_5,s[o.cTFRGBA4444]=c.vK.UNSIGNED_SHORT_4_4_4_4,s),h=Object.keys(_).map((function(e){return Number(e)})).reduce((function(e,r){return e[_[r]]=r,e}),{}),B=((a={})[o.cTFBC3]=!0,a[o.cTFPVRTC1_4_RGBA]=!0,a[o.cTFASTC_4x4]=!0,a);function g(){var e,r={init:function(r){return self.BASIS?(self.BASIS({wasmBinary:r.wasmSource}).then((function(r){r.initializeBasis(),e=r,self.postMessage({type:"init",success:!0})})),null):(console.warn("jsSource was not prepended?"),{type:"init",success:!1})},transcode:function(r){var t=r.basisData,n=new e.BasisFile(t),s=n.getNumImages(),a=n.getHasAlpha()?r.rgbaFormat:r.rgbFormat,o=new Array(s),i=!1;if(!n.startTranscoding())return n.close(),n.delete(),{type:"transcode",requestID:r.requestID,success:!1,imageArray:null};for(var c=0;c<s;c++){for(var u=n.getNumLevels(c),l={imageID:c,levelArray:new Array,width:null,height:null},f=0;f<u;f++){var d=i?14:a,T=n.getImageWidth(c,f),_=n.getImageHeight(c,f),m=n.getImageTranscodedSizeInBytes(c,f,d),h=T+3&-4,B=_+3&-4;0===f&&(l.width=h,l.height=B);var g=new Uint8Array(m);if(!n.transcodeImage(g,c,f,d,!1,!1)){if(i)return console.error("Basis failed to transcode image "+c+", level "+f+"!"),{type:"transcode",requestID:r.requestID,success:!1};console.warn("Basis failed to transcode image "+c+", level "+f+"! Retrying to an uncompressed texture format!"),c=-1,i=!0;break}l.levelArray.push({levelID:f,levelWidth:T,levelHeight:_,levelBuffer:g})}o[c]=l}return n.close(),n.delete(),{type:"transcode",requestID:r.requestID,success:!0,basisFormat:i?14:a,imageArray:o}}};self.onmessage=function(e){var t=e.data,n=r[t.type](t);n&&self.postMessage(n)}}var v=function(){function e(){var r=this;this.requests={},this.onMessage=function(e){var t=e.data;if("init"===t.type){if(!t.success)throw new Error("BasisResource.TranscoderWorker failed to initialize.");r.isInit=!0,r.onInit()}else if("transcode"===t.type){--r.load;var n=t.requestID;t.success?r.requests[n].resolve(t):r.requests[n].reject(),delete r.requests[n]}},this.isInit=!1,this.load=0,this.initPromise=new Promise((function(e){r.onInit=e})),e.wasmSource||console.warn("PIXI.resources.BasisResource.TranscoderWorker has not been given the transcoder WASM binary!"),this.worker=new Worker(e.workerURL),this.worker.onmessage=this.onMessage,this.worker.postMessage({type:"init",jsSource:e.jsSource,wasmSource:e.wasmSource})}return Object.defineProperty(e,"workerURL",{get:function(){if(!e._workerURL){var r=g.toString(),t=r.indexOf("{"),n=r.lastIndexOf("}");r=r.slice(t+1,n),e.jsSource&&(r=e.jsSource+"\n"+r),e._workerURL=URL.createObjectURL(new Blob([r]))}return e._workerURL},enumerable:!1,configurable:!0}),e.prototype.initAsync=function(){return this.initPromise},e.prototype.transcodeAsync=function(r,t,n){return d(this,void 0,Promise,(function(){var s,a,o=this;return T(this,(function(i){return++this.load,s=e._tempID++,a=new Promise((function(e,r){o.requests[s]={resolve:e,reject:r}})),this.worker.postMessage({requestID:s,basisData:r,rgbaFormat:t,rgbFormat:n,type:"transcode"}),[2,a]}))}))},e.loadTranscoder=function(r,t){var n=this,s=fetch(r).then((function(e){return e.text()})).then((function(r){e.jsSource=r})),a=fetch(t).then((function(e){return e.arrayBuffer()})).then((function(r){e.wasmSource=r}));return Promise.all([s,a]).then((function(e){return n._onTranscoderInitializedResolve(),e}))},e.setTranscoder=function(r,t){e.jsSource=r,e.wasmSource=t},e.onTranscoderInitialized=new Promise((function(r){e._onTranscoderInitializedResolve=r})),e._tempID=0,e}(),R=function(){function e(){}return e.transcode=function(r){return d(this,void 0,Promise,(function(){var t;return T(this,(function(n){switch(n.label){case 0:return"undefined"!==typeof Worker&&e.TranscoderWorker.wasmSource?[4,e.transcodeAsync(r)]:[3,2];case 1:return t=n.sent(),[3,3];case 2:t=e.transcodeSync(r),n.label=3;case 3:return[2,t]}}))}))},e.transcodeAsync=function(r){return d(this,void 0,Promise,(function(){var t,n,s,a,o,c,l,f,d,m;return T(this,(function(T){switch(T.label){case 0:for(e.defaultRGBAFormat||e.defaultRGBFormat||e.autoDetectFormats(),t=e.workerPool,n=268435456,s=null,d=0,m=t.length;d<m;d++)t[d].load<n&&(s=t[d],n=s.load);return s||(s=new v,t.push(s)),[4,s.initAsync()];case 1:return T.sent(),[4,s.transcodeAsync(new Uint8Array(r),e.defaultRGBAFormat.basisFormat,e.defaultRGBFormat.basisFormat)];case 2:if(a=T.sent(),o=a.basisFormat,c=a.imageArray,o>12)l=c.map((function(e){return new i.qm(new Uint16Array(e.levelArray[0].levelBuffer.buffer),{width:e.width,height:e.height})}));else for(f=_[a.basisFormat],l=new Array(c.length),d=0,m=c.length;d<m;d++)l[d]=new u.f6(null,{format:f,width:c[d].width,height:c[d].height,levelBuffers:c[d].levelArray,levels:c[d].levelArray.length});return l.basisFormat=o,[2,l]}}))}))},e.transcodeSync=function(r){e.defaultRGBAFormat||e.defaultRGBFormat||e.autoDetectFormats();var t=e.basisBinding,n=new Uint8Array(r),s=new t.BasisFile(n),a=s.getNumImages(),c=s.getHasAlpha()?e.defaultRGBAFormat.basisFormat:e.defaultRGBFormat.basisFormat,l=o.cTFRGB565,f=new Array(a),d=e.fallbackMode;if(!s.startTranscoding())return console.error("Basis failed to start transcoding!"),s.close(),s.delete(),null;for(var T=0;T<a;T++){for(var m=d?1:s.getNumLevels(T),h=s.getImageWidth(T,0),B=s.getImageHeight(T,0),g=h+3&-4,v=B+3&-4,R=new Array(m),F=0;F<m;F++){var w=s.getImageWidth(T,F),A=s.getImageHeight(T,F),b=s.getImageTranscodedSizeInBytes(T,0,d?l:c);if(R[F]={levelID:F,levelBuffer:new Uint8Array(b),levelWidth:w,levelHeight:A},s.transcodeImage(R[F].levelBuffer,T,0,d?l:c,!1,!1));else{if(d){console.error("Basis failed to transcode image "+T+", level 0!");break}T=-1,d=!0,console.warn("Basis failed to transcode image "+T+", level 0 to a compressed texture format. Retrying to an uncompressed fallback format!")}}var p=void 0;p=d?new i.qm(new Uint16Array(R[0].levelBuffer.buffer),{width:h,height:B}):new u.f6(null,{format:_[c],width:g,height:v,levelBuffers:R,levels:m}),f[T]=p}s.close(),s.delete();var y=f;return y.basisFormat=d?l:c,y},e.autoDetectFormats=function(r){if(!r){var t=f.Xd.ADAPTER.createCanvas().getContext("webgl");if(!t)return void console.error("WebGL not available for BASIS transcoding. Silently failing.");r={s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),astc:t.getExtension("WEBGL_compressed_texture_astc"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc")}}var n={};for(var s in r){var a=r[s];a&&Object.assign(n,Object.getPrototypeOf(a))}for(var i=0;i<2;i++){var u=!!i,l=void 0,d=void 0;for(var T in n)if(void 0!==(d=h[l=n[T]])&&(u&&B[d]||!u&&!B[d]))break;l?e[u?"defaultRGBAFormat":"defaultRGBFormat"]={textureFormat:l,basisFormat:d}:(e[u?"defaultRGBAFormat":"defaultRGBFormat"]={textureFormat:c.vK.UNSIGNED_SHORT_5_6_5,basisFormat:o.cTFRGB565},e.fallbackMode=!0)}},e.bindTranscoder=function(r){e.basisBinding=r},e.loadTranscoder=function(r,t){return e.TranscoderWorker.loadTranscoder(r,t)},e.setTranscoder=function(r,t){e.TranscoderWorker.setTranscoder(r,t)},Object.defineProperty(e,"TRANSCODER_WORKER_POOL_LIMIT",{get:function(){return this.workerPool.length||1},set:function(e){for(var r=this.workerPool.length;r<e;r++)this.workerPool[r]=new v,this.workerPool[r].initAsync()},enumerable:!1,configurable:!0}),e.extension=i.nw.Loader,e.fallbackMode=!1,e.workerPool=[],e.TranscoderWorker=v,e}();l.kC.setExtensionXhrType("basis",l.kC.XHR_RESPONSE_TYPE.BUFFER);var F=function(){function e(){}return e.use=function(r,t){var n=this;"basis"===r.extension&&r.data?d(n,void 0,void 0,(function(){var n;return T(this,(function(s){switch(s.label){case 0:return R.basisBinding||R.TranscoderWorker.wasmSource?[3,2]:[4,v.onTranscoderInitialized];case 1:s.sent(),s.label=2;case 2:return[4,R.transcode(r.data)];case 3:return n=s.sent(),Object.assign(r,e.registerTextures(r.url,n,r.metadata)),t(),[2]}}))})):t()},e.registerTextures=function(e,r,t){var n={textures:{},texture:null};if(!r)return n;var s=m[r.basisFormat],a=r.basisFormat!==o.cTFRGBA32?c.I2.RGB:c.I2.RGBA;return r.map((function(e){return new i.xE(new i.VL(e,Object.assign({mipmap:e instanceof u.f6&&e.levels>1?c.WB.ON_MANUAL:c.WB.OFF,alphaMode:c.iw.NO_PREMULTIPLIED_ALPHA,type:s,format:a},t)))})).forEach((function(r,t){var s=r.baseTexture,a=e+"-"+(t+1);i.VL.addToCache(s,a),i.xE.addToCache(r,a),0===t&&(i.VL.addToCache(s,e),i.xE.addToCache(r,e),n.texture=r),n.textures[a]=r})),n},e.bindTranscoder=function(e){R.basisBinding=e},e.loadTranscoder=function(e,r){return R.TranscoderWorker.loadTranscoder(e,r)},e.setTranscoder=function(e,r){R.TranscoderWorker.setTranscoder(e,r)},e.extension=i.nw.Loader,e}();i.Rw.add(F)}}]);